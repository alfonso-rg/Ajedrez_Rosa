<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Ajedrez Primos Rosa</title>
    <link rel="stylesheet"
      href="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.css"
      integrity="sha384-q94+BZtLrkL1/ohfjR8c6L+A6qzNH9R2hBLwyoAfu3i/WCvQjzL2RQJ3uNHDISdU"
      crossorigin="anonymous">
    
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Comic+Neue:wght@700&display=swap" rel="stylesheet">

    <style>
        /* Fondo soleado de Murcia y estilos generales */
        body {
            font-family: 'Comic Neue', cursive; /* Letra f√°cil de leer para ni√±os */
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%); /* Degradado soleado */
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            color: #333;
        }

        /* El contenedor principal del juego (la caja blanca) */
        .game-container {
            background-color: rgba(255, 255, 255, 0.9); /* Blanco semitransparente */
            padding: 30px;
            border-radius: 25px; /* Bordes muy redondeados */
            box-shadow: 0 10px 25px rgba(0,0,0,0.2); /* Sombra para que "flote" */
            text-align: center;
            border: 4px solid #FF6B6B; /* Borde color rosa fuerte */
        }

        /* El t√≠tulo principal */
        h1 {
            font-family: 'Fredoka One', cursive; /* Letra gordita y divertida */
            color: #FF6B6B; /* Color rosa/rojo */
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 0px #FFD93D; /* Sombra amarilla */
        }
        
        /* Subt√≠tulo murciano */
        .subtitle {
            font-size: 1.2em;
            color: #e67e22; /* Color naranja huertano */
            margin-bottom: 20px;
        }

        /* El tablero */
        #board {
            width: 400px;
            margin: 0 auto; /* Centrado */
            border: 5px solid #FFD93D; /* Borde amarillo lim√≥n */
            border-radius: 10px;
        }

        /* La caja de estado (de qui√©n es el turno) */
        #status-box {
            margin-top: 25px;
            padding: 15px;
            border-radius: 15px;
            background-color: #4ECDC4; /* Verde agua alegre */
            color: white;
            font-size: 1.3em;
            font-weight: bold;
            box-shadow: 0 5px 0px #2cb5ac; /* Efecto 3D */
        }

        /* Personalizaci√≥n de colores del tablero (Rosa y Crema) */
        .white-1e1d7 {
            background-color: #fffdd0; /* Color crema */
            color: #b58863;
        }
        .black-3c85d {
            background-color: #ffcccb; /* Color rosa claro */
            color: #f0d9b5;
        }
    </style>
</head>
<body>

    <div class="game-container">
        <h1>‚ôüÔ∏è El Gran Duelo de los Primos Rosa ‚ôüÔ∏è</h1>
        <div class="subtitle">üçã Desde Murcia con alegr√≠a üçã</div>
        
        <div id="board"></div>
        
        <div id="status-box">
            <span id="status">Conectando...</span>
        </div>
    </div>


    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>

    <script>
        const socket = io();
        const game = new Chess();
        let board = null;
        let playerColor = null;

        const $status = $('#status');

        function onDragStart (source, piece, position, orientation) {
            if (game.game_over()) return false;
            if ((playerColor === 'white' && piece.search(/^b/) !== -1) ||
                (playerColor === 'black' && piece.search(/^w/) !== -1)) {
                return false;
            }
            if ((game.turn() === 'w' && playerColor !== 'white') ||
                (game.turn() === 'b' && playerColor !== 'black')) {
                return false;
            }
        }

        function onDrop (source, target) {
            const move = game.move({
                from: source,
                to: target,
                promotion: 'q' 
            });

            if (move === null) return 'snapback';

            socket.emit('move', move);
            updateStatus();
        }

        function onSnapEnd () {
            board.position(game.fen());
        }

        function updateStatus () {
            let status = '';
            let moveColor = (game.turn() === 'b') ? 'Negras' : 'Blancas';

            if (game.in_checkmate()) {
                status = '¬°Jaque Mate! Ganan las ' + ((moveColor === 'Blancas') ? 'Negras' : 'Blancas');
            } else if (game.in_draw()) {
                status = '¬°Juego terminado en tablas!';
            } else {
                status = 'Turno de las: ' + moveColor.toUpperCase();
                if (game.in_check()) {
                    status += ' (¬°Est√°n en JAQUE!)';
                }
            }
            // Mensaje personalizado para Mart√≠n y Pablo
            let myColorText = (playerColor === 'white' ? 'T√∫ llevas las BLANCAS (Empiezas)' : 'T√∫ llevas las NEGRAS');
            $status.html(status + '<br><span style="font-size: 0.8em">üëâ ' + myColorText + ' üëà</span>');
        }

        const config = {
            draggable: true,
            position: 'start',
            onDragStart: onDragStart,
            onDrop: onDrop,
            onSnapEnd: onSnapEnd,
            // Im√°genes de piezas oficiales
            pieceTheme: 'https://chessboardjs.com/img/chesspieces/wikipedia/{piece}.png'
        };
        
        // Inicializar tablero
        board = Chessboard('board', config);

        // Eventos de Socket.io
        socket.on('playerColor', (color) => {
            playerColor = color;
            board.orientation(color);
            updateStatus();
        });

        socket.on('move', (move) => {
            game.move(move);
            board.position(game.fen());
            updateStatus();
        });

        socket.on('spectator', () => {
            $status.html("Mart√≠n y Pablo ya est√°n jugando. Est√°s mirando.");
        });

    </script>
</body>
</html>
